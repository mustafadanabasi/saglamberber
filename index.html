<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Umut Berber Randevu</title>
<style>
  :root{
    --brand:#0d47a1;
    --brand-2:#1565c0;
    --bg:#f9f9f9;
    --card:#ffffff;
    --border:#ddd;
    --shadow: 0 4px 12px rgb(0 0 0 / 0.1);

    /* Bubble tones */
    --bot-bg: #eaf3ff;
    --bot-border: #cfe2ff;
    --bot-text: #0d47a1;

    --user-bg: #e6fbf9;
    --user-border: #bfe8e6;
    --user-text: #0a3d45;
  }
  *{ box-sizing:border-box; }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: var(--bg);
    color: #333;
    margin: 0; padding: 0;
    display: flex; flex-direction: column; min-height: 100vh;
  }
  header {
    background-color: #e3f2fd;
    padding: 20px 0;
    text-align: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.1);
  }
  header h1 {
    margin: 10px 0 5px;
    font-weight: 700;
    font-size: 2.25rem;
    color: var(--brand);
    letter-spacing: 0.06em;
  }
  header p.slogan {
    margin: 0;
    font-style: italic;
    color: var(--brand-2);
    font-size: 1.15rem;
  }
  main {
    flex: 1;
    padding: 20px;
    max-width: 1040px;
    margin: 0 auto;
    width: 100%;
  }

  /* Layout: logo on left, chat centered in page */
  .chat-wrap{
    display: grid;
    grid-template-columns: 1fr auto 1fr; /* left empty area, chat, right empty area */
    align-items: center;
    justify-items: center;
    min-height: 40vh;
    gap: 16px;
  }
  /* Place logo left of chat, in the left column content area */
  .brand-col{
    grid-column: 1 / 2;
    justify-self: end;            /* stick logo toward chat */
    display:flex; align-items:center; justify-content:flex-end;
    width: 100%;
  }
  .brand-logo{
    flex-shrink: 0;
    display:flex; align-items:center; justify-content:center;
    padding-right: 20px;          /* space between logo and chat */
  }
  .brand-logo img{
    height: 240px;
    width: auto;
    border-radius: 12px;
    box-shadow: var(--shadow);
  }

  /* Chat centered column */
  .chat-col{
    grid-column: 2 / 3;
    justify-self: center;
  }

  .chat-window {
    background: var(--card);
    border-radius: 10px;
    box-shadow: var(--shadow);
    width: min(100%, 640px);
    height: 440px;
    display: flex;
    flex-direction: column;       /* input area stays at bottom by default */
    border: 1px solid var(--border);
  }

  /* messages area flex:1 ensures input area stays at bottom */
  .messages{
    flex: 1;
    overflow-y: auto;
    padding: 14px 16px;
    display: flex;
    flex-direction: column;
    gap: 8px;
  }

  /* bubbles */
  .messages .bot-msg,
  .messages .user-msg{
    max-width: 78%;
    padding: 10px 12px;
    border-radius: 14px;
    line-height: 1.4;
    border: 1px solid transparent;
    box-shadow: 0 2px 8px rgba(0,0,0,.06);
    position: relative;
    word-wrap: break-word;
    overflow-wrap: anywhere;
    white-space: pre-wrap;
  }
  .messages .bot-msg{
    align-self: flex-start;
    background: var(--bot-bg);
    border-color: var(--bot-border);
    color: var(--bot-text);
  }
  .messages .user-msg{
    align-self: flex-end;
    background: var(--user-bg);
    border-color: var(--user-border);
    color: var(--user-text);
  }

  /* input area pinned to bottom (because of flex column + no flex on this row) */
  .input-area {
    border-top: 1px solid var(--border);
    display: flex;
    align-items: center;
    padding: 10px;
    gap: 10px;
  }
  .input-area input[type="text"] {
    flex: 1;
    border: 1px solid #ccc;
    border-radius: 10px;
    padding: 12px 14px;
    font-size: 1rem;
    outline: none;
    height: 44px;
  }
  .input-area button {
    background-color: var(--brand);
    border: none;
    padding: 0 16px;
    color: white;
    font-size: 1rem;
    border-radius: 10px;
    cursor: pointer;
    height: 44px;
  }
  .input-area button:hover {
    background-color: var(--brand-2);
  }

  footer {
    background: #e3f2fd;
    padding: 20px;
    text-align: center;
    font-size: 0.9rem;
    color: #333;
  }

  @media (max-width: 900px){
    .chat-wrap{
      grid-template-columns: 1fr;   /* stack */
      gap: 8px;
    }
    .brand-col, .chat-col{ grid-column: auto; }
    .brand-col{ justify-self:center; }
    .brand-logo{ padding-right: 0; margin-bottom: 4px; }
    .brand-logo img{ height: 160px; }
    .chat-window{ width: 100%; }
  }
</style>
</head>
<body>
<header>
  <h1>UMUT BERBER</h1>
  <p class="slogan">Saçınıza Değer</p>
</header>

<main>
  <div class="chat-wrap">

    <!-- Left area: logo sitting in remaining space to the left -->
    <div class="brand-col">
      <div class="brand-logo">
        <img src="saglam.png" alt="Barbershop Logo" />
      </div>
    </div>

    <!-- Center: chat window -->
    <div class="chat-col">
      <div class="chat-window" id="chatWindow">
        <div class="messages" id="messages"></div>

        <div class="input-area">
          <input type="text" id="userInput" placeholder="Mesajınızı yazın..." />
          <button id="sendBtn" type="button">Gönder</button>
        </div>
      </div>
    </div>

    <!-- right column left empty to keep chat centered -->
    <div></div>
  </div>
</main>

<footer>
  <p>7355 sk. No:203/G Karşıyaka /İzmir</p>
  <p>© MustafaDanabaşı</p>
</footer>

<script>
// === n8n webhook URL (production) ===
const WEBHOOK_URL = "https://primary-production-2ab1.up.railway.app/webhook/randevu";

const chatWindow = document.getElementById('messages');
const userInput = document.getElementById('userInput');
const sendBtn = document.getElementById('sendBtn');

function formatMarkdown(text) {
  return text
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')  // **kalın**
    .replace(/\*(.*?)\*/g, '<em>$1</em>')              // *italik*
    .replace(/\[(.*?)\]\((.*?)\)/g, '<a href="$2" target="_blank">$1</a>'); // [link](url)
}

function appendMessage(content, className) {
  const div = document.createElement('div');
  div.innerHTML = formatMarkdown(content);  // innerHTML ile göster
  div.className = className;
  chatWindow.appendChild(div);
  chatWindow.scrollTop = chatWindow.scrollHeight;
}	

// Welcome message kept on one line to avoid odd wrap
appendMessage('Randevu oluşturma, değiştirme veya iptal için yazabilirsiniz. Lütfen adınız, telefon numaranız ve tarih/saat bilgisiyle birlikte iletin.', 'bot-msg');

async function sendMessage() {
  const message = userInput.value.trim();
  if (!message) return;

  appendMessage(message, 'user-msg');
  userInput.value = '';

  try {
    const res = await fetch(WEBHOOK_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        sessionId: "webclient-1",
        message: message,
        metadata: { source: "Salon-Web" }
      })
    });

    const data = await res.json().catch(() => ({}));
	console.log(data);
    const reply = data.reply || data.answer || "Randevu talebiniz iletildi.";
    appendMessage(reply, 'bot-msg');
  } catch (error) {
    appendMessage("Bağlantı hatası: " + error.message, 'bot-msg');
  }
}

// Send by button
sendBtn.addEventListener("click", sendMessage);

// Send on Enter (without Shift)
userInput.addEventListener("keydown", function (event) {
  if (event.key === "Enter" && !event.shiftKey) {
    event.preventDefault();
    sendMessage();
  }
});
</script>
</body>
</html>
